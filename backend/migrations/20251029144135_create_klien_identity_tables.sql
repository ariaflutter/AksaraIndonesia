-- Add migration script here
-- Migration 2: Create the Core Klien Identity Table

CREATE TYPE tipe_klien AS ENUM ('Dewasa', 'Anak');
CREATE TYPE tingkat_pendidikan AS ENUM (
    'Tidak Sekolah', 'SD Tidak Lulus', 'SD atau Sederajat', 'SMP atau Sederajat',
    'SMA atau Sederajat', 'D1 atau Sederajat', 'D2 atau Sederajat', 'D3 atau Sederajat',
    'S1 atau Sederajat', 'S2 atau Sederajat', 'S3 atau Sederajat'
);
CREATE TYPE jenis_pekerjaan AS ENUM (
   'BELUM/TIDAK BEKERJA',
'PEGAWAI NEGERI SIPIL',
'TENTARA NASIONAL INDONESIA',
'KEPOLISIAN RI',
'KARYAWAN BUMN',
'KARYAWAN BUMD',
'ANGGOTA DPR-RI',
'ANGGOTA DPD',
'ANGGOTA BPK',
'PRESIDEN',
'WAKIL PRESIDEN',
'ANGGOTA MAHKAMAH KONSTITUSI',
'ANGGOTA KABINET/KEMENTERIAN',
'DUTA BESAR',
'GUBERNUR',
'WAKIL GUBERNUR',
'BUPATI',
'WAKIL BUPATI',
'WALIKOTA',
'WAKIL WALIKOTA',
'ANGGOTA DPRD PROVINSI',
'ANGGOTA DPRD KABUPATEN/KOTA',
'PENGACARA',
'NOTARIS',
'PENELITI',
'PERANGKAT DESA',
'KEPALA DESA',
'DOSEN',
'GURU',
'PERDAGANGAN',
'INDUSTRI',
'KONSTRUKSI',
'TRANSPORTASI',
'KARYAWAN SWASTA',
'KARYAWAN HONORER',
'BURUH HARIAN LEPAS',
'PEMBANTU RUMAH TANGGA',
'TUKANG CUKUR',
'TUKANG LISTRIK',
'TUKANG BATU',
'TUKANG KAYU',
'TUKANG SOL SEPATU',
'TUKANG LAS/PANDAI BESI',
'TUKANG JAHIT',
'TUKANG GIGI',
'PENATA RIAS',
'PENATA BUSANA',
'PENATA RAMBUT',
'MEKANIK',
'SENIMAN',
'TABIB',
'PARAJI',
'PERANCANG BUSANA',
'PENTERJEMAH',
'WARTAWAN',
'JURU MASAK',
'PROMOTOR ACARA',
'PILOT',
'ARSITEK',
'AKUNTAN',
'KONSULTAN',
'PENYIAR TELEVISI',
'PENYIAR RADIO',
'PELAUT',
'SOPIR',
'PIALANG',
'PARANORMAL',
'PEDAGANG',
'WIRASWASTA',
'PETANI/PEKEBUN',
'PETERNAK',
'BURUH TANI/PERKEBUNAN',
'BURUH PETERNAKAN',
'NELAYAN/PERIKANAN',
'BURUH NELAYAN/PERIKANAN',
'IMAM MESJID',
'PENDETA',
'PASTOR',
'USTADZ/MUBALIGH',
'BIARAWATI',
'PELAJAR/MAHASISWA',
'DOKTER',
'BIDAN',
'PERAWAT',
'APOTEKER',
'PSIKIATER/PSIKOLOG',
'PENSIUNAN',
'MENGURUS RUMAH TANGGA',
'LAINNYA'
);
CREATE TYPE kewarganegaraan_enum AS ENUM ('WNI', 'WNA');

CREATE TABLE klien (
    id SERIAL PRIMARY KEY,
    tipe tipe_klien NOT NULL,
    nama TEXT NOT NULL,
    alamat TEXT,
    tempat_lahir VARCHAR(100),
    tanggal_lahir DATE,
    jenis_kelamin VARCHAR(20),
    agama VARCHAR(50),
    pekerjaan jenis_pekerjaan,
    pendidikan_terakhir tingkat_pendidikan,
    bapas_id INTEGER NOT NULL REFERENCES bapas(id) ON DELETE RESTRICT,
    pk_id INTEGER NOT NULL REFERENCES users(id) ON DELETE RESTRICT,
    kanwil_id INTEGER REFERENCES kanwil(id) ON DELETE SET NULL,
    online_akses BOOLEAN NOT NULL DEFAULT FALSE,
    pengulangan BOOLEAN NOT NULL DEFAULT FALSE, -- To detect recidivism
    kewarganegaraan kewarganegaraan_enum,
    negara_asal VARCHAR(100), -- Only if WNA
    suku VARCHAR(100),
    keterangan TEXT,
    catatan TEXT,
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    created_by INTEGER REFERENCES users(id) ON DELETE SET NULL,
    updated_by INTEGER REFERENCES users(id) ON DELETE SET NULL
);
CREATE TRIGGER set_timestamp BEFORE UPDATE ON klien FOR EACH ROW EXECUTE PROCEDURE trigger_set_timestamp();